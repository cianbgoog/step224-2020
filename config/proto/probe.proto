/*
  This proto defines the initial probe interface for Hermes probes.
  It is used in a variety of other files as it is the top-level probe interface.
*/
syntax = "proto3";

package hermes;

import "github.com/google/cloudprober/metrics/proto/dist.proto";
import "github.com/googleinterns/step224-2020/config/proto/targets.proto";

option go_package = "github.com/googleinterns/step224-2020/config/proto";
  // This defines the top-level probe interface for Hermes probes.
  // All Hermes probes should extend this probe config.
message HermesProbeDef {
  required string probe_name= 1;
  required targets.TargetsDef targets = 2;

  enum TargetSystem {
    GCS = 1;
    CEPH = 2;
  }

  // Probe types currently supported
  enum ProbeType {
    GET = 1; // GET probe is for getting an object (file) from a storage system.
    PUT = 2; // PUT probe is for putting an object (file) into a storage system.  
    DELETE = 3; // DELETE probe is for deleting an object (file) from a storage system.
  }

  TargetSystem target_system = 3;
  ProbeType probe_type = 4;

  optional int32 interval_sec = 5 [default = 3600]; // Probing interval in seconds

  // Probes will not retry, they will fail if they timeout.
  optional int32 timeout_sec = 6 [default = 60]; // Timeout in seconds

  // If specified, latency is stored as a distribution
  optional metrics.Dist probe_latency_distribution = 7; // This measures the latency of Hermes' probes, allowing you to diagnose a network issue or issue with Hermes.
  optional metrics.Dist api_call_latency_distribution = 8; // This measures the latency of the API calls for the relevant storage system targeted.

  // Valid values: "ns", "us" (or "Âµs"), "ms", "s", "m", "h".
  optional string latency_unit = 9 [default = "us"];

  // Additional labels for the probe latency and API call latency distribution metrics.
  // Add as key-value pairs
  repeated AdditionalLabel probe_latency_additional_label = 10;
  repeated AdditionalLabel api_call_latency_additional_label = 11;
}

// Simple Key-Value pair for additional metric labels
// Uses key, value instead of Map to allow for `repeated` keyword.
message AdditionalLabel {
  required string key = 1;
  required string value = 2;
}
